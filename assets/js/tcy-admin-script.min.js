/*!
 * Admin script of centurylib
 * @package themecentury
 * @subpackage centurylib
 */
!function(g){"use strict";var h,d=g(document);(h={Repeater:function(){var v=function(e){e.find("[name]").each(function(){g(this).trigger("change")})},t=function(){var e=g(".centurylib-main-repeater");e.sortable({orientation:"vertical",items:"> .tcy-widget-repeater-table",placeholder:"tcy-sortable-placeholder",update:function(e,i){v(i.item)}}),e.trigger("sortupdate"),e.sortable("refresh")};d.on("widget-added widget-updated panelsopen",function(e,i){t()}),g(function(){"widgets"===window.pagenow&&g(".widgets-holder-wrap:not(#available-widgets)").find("div.widget").one("click.toggle-widget-expanded",function(){t()})}),d.on("click",".tcy-add-repeater",function(e){e.preventDefault();var i=g(this),t=i.closest(".centurylib-main-repeater"),n=t.find(".tcy-code-for-repeater"),a=t.find(".tcy-total-repeater-counter"),r=parseInt(a.val()),o=n.html();a.val(r+1);var c,s,l,d,p=(c=o,s=i.attr("id"),l=r,d=new RegExp(s,"g"),c.replace(d,l));i.before(g('<div class="tcy-widget-repeater-table"></div>').append(p));var u=i.prev(".tcy-widget-repeater-table"),f=u.find(".centurylib-inside-repeater");f.slideDown("fast",function(){u.addClass("open"),v(u)}),h.Snipits.Color_Picker(f.find(".tcy-color-picker:not(.wp-color-picker)"))}),d.on("click",".centurylib-repeater-top, .centurylib-main-repeater-close",function(e){e.preventDefault();var i=g(this).closest(".tcy-widget-repeater-table"),t=i.find(".centurylib-inside-repeater");t.is(":hidden")?t.slideDown("fast",function(){i.addClass("open")}):t.slideUp("fast",function(){i.removeClass("open")})}),d.on("click",".centurylib-main-repeater-remove",function(e){e.preventDefault();var i=g(this),t=i.closest(".tcy-widget-repeater-table"),n=i.closest(".centurylib-main-repeater");t.remove(),n.closest("form").trigger("change"),v(n)}),d.on("change",".tcy-select",function(e){e.preventDefault();var i=g(this),t=i.closest(".centurylib-inside-repeater"),n=t.find(".tcy-postid"),a=t.find(".centurylib-main-repeater-control-actions"),r=i.find("option:selected").val();0==r?n.remove():(n.remove(),g.ajax({type:"GET",data:{action:"teg_get_edit_post_link",id:r},url:ajaxurl,beforeSend:function(e,i){n.remove()},success:function(e){0!=e&&a.append(e)},error:function(e,i,t){console.log(e+" :: "+i+" :: "+t)}}))})},Snipits:{Variables:function(){g(window).width(),g(window).height()},Color_Picker:function(n){var e={change:function(e,i){var t=i.color.toString();g(e.target).val(t).trigger("change"),n.closest("form").trigger("change")}};n.wpColorPicker(e)},ImageUpload:function(e){e.preventDefault();var i=g(this).data("title"),t=g(this).data("button"),n=g(this).prev(),a=g(this).prev().prev().children("img"),r=g(this).siblings(".img-preview-wrap"),o=wp.media.frames.meta_image_frame=wp.media({title:i,button:{text:t},library:{type:"image"}});o.open(),o.on("select",function(){var e=o.state().get("selection").first().toJSON();n.val(e.url),null!=a&&(a.attr("src",e.url),r.show()),n.trigger("change")})},WidgetTab:function(e){var i,t;g(this).hasClass("nav-tab-active")||(t=g(this).data("id"),i=g(this).closest(".tcy-widget-field-tab-wraper"),g(this).addClass("nav-tab-active").siblings(".nav-tab").removeClass("nav-tab-active"),i.find(".centurylib-tab-contents").removeClass("centurylib-tab-active"),i.find(t).addClass("centurylib-tab-active"))},Widget_Accordion:function(){var e=g(this).closest(".centurylib-accordion-title");g(this).prop("checked")?(e.siblings(".centurylib-accordion-content").slideDown().removeClass("open close"),e.find(".centurylib-accordion-arrow").addClass("fa-angle-up").removeClass("fa-angle-down")):(e.siblings(".centurylib-accordion-content").slideUp().removeClass("open close"),e.find(".centurylib-accordion-arrow").addClass("fa-angle-down").removeClass("fa-angle-up"))},Widget_Relation_Action:function(e,i,t){var n=e.val();for(var a in"CHECKBOX"==e.prop("tagName")&&(n=e.is(":checkbox")&&e.is(":checked")?n:""),i){if("empty"==t||"exist"==t)n=t;else if("values"==t&&a!=n)continue;var r=i[a];for(var o in r){var c="."+r[o].join(", .");switch(o){case"show_fields":e.closest(".widget-content").find(c).removeClass("centurylib-hidden-field");break;case"hide_fields":e.closest(".widget-content").find(c).addClass("centurylib-hidden-field");break;default:console.warn("Action "+a+" case is not defined")}}}},Widget_Relation:function(e){var i=g(this),t=i.val();"CHECKBOX"==i.prop("tagName")&&(t=i.is(":checkbox")&&i.is(":checked")?t:"");var n=g(this).data("relations");if(n){var a=h.Snipits.Widget_Relation_Action;for(var r in n){var o=n[r];if(o)switch(r){case"exist":t&&a(i,{exist:o},r);break;case"empty":t||a(i,{empty:o},r);break;case"values":o&&a(i,o,r);break;default:console.warn("Relation key "+r+"is not found.")}}}},CustomizerIcons:function(){var e=g(this),i=e.closest(".centurylib-icons-wrapper"),t=e.children("i").attr("class"),n=t.split(" ")[1];e.siblings().removeClass("selected"),e.addClass("selected"),i.find(".tcy-icon-value").val(n),i.find(".centurylib-icon-preview").html('<i class="'+t+'"></i>'),i.find(".tcy-icon-value").trigger("change")},IconToggle:function(){var e=g(this).closest(".centurylib-icons-wrapper"),i=e.find(".icons-list-wrapper"),t=e.find(".dashicons");i.is(":hidden")?(i.slideDown(),t.removeClass("dashicons-arrow-down"),t.addClass("dashicons-arrow-up")):(i.slideUp(),t.addClass("dashicons-arrow-down"),t.removeClass("dashicons-arrow-up"))},RemoveIcon:function(){var e=g(this).closest(".centurylib-icons-wrapper"),i=e.find(".icons-list-wrapper");e.find(".tcy-icon-value").val(""),e.find(".centurylib-icon-preview").html(""),i.find(".single-icon").removeClass("selected")},IconSearch:function(){var e=g(this),i=this.value;e.closest(".centurylib-icons-wrapper").find(".icons-list-wrapper").find("i").each(function(){-1<g(this).attr("class").search(i)?g(this).parent(".single-icon").show():g(this).parent(".single-icon").hide()})},Widget_Change:function(e,i){var t=h.Snipits,n=g(i);n.find(".centurylib_widget_field_relation").trigger("change"),t.Color_Picker(n.find(".tcy-color-picker")),n.hasClass("widget-dirty")&&(n.removeClass("widget-dirty"),n.find('input[type="submit"]').attr("disabled","disabled"))}},Click:function(){var e=h.Snipits,i=e.ImageUpload;d.on("click",".media-image-upload",i);var t=e.WidgetTab;d.on("click",".tcy-widget-tab-list .nav-tab",t);var n=e.Widget_Relation;g(document).on("change",".centurylib_widget_field_relation",n),g(".centurylib_widget_field_relation").trigger("change"),d.on("click",".media-image-remove",function(e){g(this).siblings(".img-preview-wrap").hide(),g(this).prev().prev().val("")});var a=e.CustomizerIcons;d.on("click",".centurylib-icons-wrapper .single-icon",a);var r=e.IconToggle;d.on("click",".centurylib-icons-wrapper .icon-toggle, .centurylib-icons-wrapper .centurylib-icon-preview",r);var o=e.RemoveIcon;d.on("click",".centurylib-icons-wrapper .remove-icon",o);var c=e.IconSearch;d.on("keyup",".centurylib-icons-wrapper .icon-search",c);var s=e.Widget_Accordion;d.on("change",".centurylib-accordion-title input",s);var l=e.Widget_Change;d.on("widget-added widget-updated panelsopen",l)},Ready:function(){var e=h,i=e.Snipits;e.Repeater(),i.Variables(),i.Color_Picker(g(".tcy-color-picker")),e.Click()},Load:function(){},Resize:function(){},Scroll:function(){},Init:function(){var e=h,i=e.Ready,t=e.Load,n=e.Resize,a=e.Scroll;g(document).ready(i),g(window).load(t),g(window).scroll(a),g(window).resize(n)}}).Init()}(jQuery);